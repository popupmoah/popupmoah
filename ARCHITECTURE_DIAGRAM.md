# PopupMoah 아키텍처 다이어그램

## 1. 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                        PopupMoah System                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────┐  │
│  │   Frontend      │    │   API Gateway   │    │   Database  │  │
│  │   (Vue3)        │◄──►│   (Spring Boot) │◄──►│ (PostgreSQL)│  │
│  └─────────────────┘    └─────────────────┘    └─────────────┘  │
│           │                       │                       │     │
│           │                       │                       │     │
│           ▼                       ▼                       ▼     │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────┐  │
│  │   File Storage  │    │   Cache Layer   │    │   Monitoring│  │
│  │   (AWS S3)      │    │   (Redis)       │    │ (Prometheus)│  │
│  └─────────────────┘    └─────────────────┘    └─────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 2. 멀티모듈 구조 (Hexagonal Architecture)

```
┌─────────────────────────────────────────────────────────────────┐
│                        popupmoah-api                           │
│                    (Web Controllers)                           │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐ │
│  │PopupStore   │  │  Category   │  │    File     │  │Community│ │
│  │Controller   │  │ Controller  │  │ Controller  │  │Controller│ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘ │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Domain Modules                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │              popupmoah-popupstore                          │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │ │
│  │  │   Domain    │  │ Application │  │   Infrastructure    │  │ │
│  │  │  (Entity,   │  │ (Use Cases, │  │  (Repository,       │  │ │
│  │  │   Service)  │  │   Ports)    │  │   External APIs)    │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │              popupmoah-category                            │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │ │
│  │  │   Domain    │  │ Application │  │   Infrastructure    │  │ │
│  │  │  (Entity,   │  │ (Use Cases, │  │  (Repository,       │  │ │
│  │  │   Service)  │  │   Ports)    │  │   External APIs)    │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │              popupmoah-file                                │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │ │
│  │  │   Domain    │  │ Application │  │   Infrastructure    │  │ │
│  │  │  (Entity,   │  │ (Use Cases, │  │  (Repository,       │  │ │
│  │  │   Service)  │  │   Ports)    │  │   External APIs)    │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │              popupmoah-community                           │ │
│  ├─────────────────────────────────────────────────────────────┤ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │ │
│  │  │   Domain    │  │ Application │  │   Infrastructure    │  │ │
│  │  │  (Entity,   │  │ (Use Cases, │  │  (Repository,       │  │ │
│  │  │   Service)  │  │   Ports)    │  │   External APIs)    │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Shared Modules                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │              popupmoah-shared                              │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │ │
│  │  │   Entity    │  │  Response   │  │     Utility         │  │ │
│  │  │  (Common    │  │   (Common   │  │    (Common          │  │ │
│  │  │   Entities) │  │   Response  │  │   Utilities)        │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │        popupmoah-infrastructure-common                     │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │ │
│  │  │   Security  │  │    Cache    │  │     Monitoring      │  │ │
│  │  │  (JWT,      │  │   (Redis    │  │   (Prometheus,      │  │ │
│  │  │   Auth)     │  │   Config)   │  │   Metrics)          │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 3. 의존성 방향 다이어그램

```
┌─────────────────┐
│   popupmoah-api │
│  (Controllers)  │
└─────────┬───────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Domain Application Layers                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐ │
│  │PopupStore   │  │  Category   │  │    File     │  │Community│ │
│  │Application  │  │Application  │  │Application  │  │Application│ │
│  │  Service    │  │  Service    │  │  Service    │  │  Service │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘ │
└─────────────────────────────────────────────────────────────────┘
          │                   │                   │
          ▼                   ▼                   ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Domain Layers                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐ │
│  │PopupStore   │  │  Category   │  │    File     │  │Community│ │
│  │  Domain     │  │   Domain    │  │   Domain    │  │ Domain  │ │
│  │ (Entities,  │  │ (Entities,  │  │ (Entities,  │  │(Entities,│ │
│  │  Services)  │  │  Services)  │  │  Services)  │  │ Services)│ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘ │
└─────────────────────────────────────────────────────────────────┘
          │                   │                   │
          ▼                   ▼                   ▼
┌─────────────────────────────────────────────────────────────────┐
│                   Infrastructure Layers                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐ │
│  │PopupStore   │  │  Category   │  │    File     │  │Community│ │
│  │Infrastructure│  │Infrastructure│  │Infrastructure│  │Infrastructure│ │
│  │(Repository, │  │(Repository, │  │(Repository, │  │(Repository, │ │
│  │ External)   │  │ External)   │  │ External)   │  │ External)   │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘ │
└─────────────────────────────────────────────────────────────────┘
          │                   │                   │
          ▼                   ▼                   ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Shared & Common                             │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │              popupmoah-shared                              │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │ │
│  │  │   Entity    │  │  Response   │  │     Utility         │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │        popupmoah-infrastructure-common                     │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │ │
│  │  │   Security  │  │    Cache    │  │     Monitoring      │  │ │
│  │  └─────────────┘  └─────────────┘  └─────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 4. MSA 전환 시 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                        API Gateway                             │
│                    (Spring Cloud Gateway)                      │
└─────────────────┬───────────────────────────────────────────────┘
                  │
    ┌─────────────┼─────────────┐
    │             │             │
    ▼             ▼             ▼
┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐
│PopupStore│ │Category │ │  File   │ │Community│
│ Service │ │ Service │ │ Service │ │ Service │
└─────────┘ └─────────┘ └─────────┘ └─────────┘
    │             │             │             │
    ▼             ▼             ▼             ▼
┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐
│PopupStore│ │Category │ │  File   │ │Community│
│Database │ │Database │ │Database │ │Database │
└─────────┘ └─────────┘ └─────────┘ └─────────┘
    │             │             │             │
    ▼             ▼             ▼             ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Shared Infrastructure                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐     │
│  │   Security  │  │    Cache    │  │     Monitoring      │     │
│  │   Service   │  │   Service   │  │     Service         │     │
│  └─────────────┘  └─────────────┘  └─────────────────────┘     │
└─────────────────────────────────────────────────────────────────┘
```

## 5. 패키지 구조 예시 (popupmoah-popupstore)

```
popupmoah-popupstore/
├── src/main/java/com/sgyj/popupmoah/popupstore/
│   ├── domain/                          # 도메인 계층
│   │   ├── entity/                      # 엔티티
│   │   │   ├── PopupStore.java
│   │   │   └── Category.java
│   │   ├── service/                     # 도메인 서비스
│   │   │   └── PopupStoreDomainService.java
│   │   ├── repository/                  # 리포지토리 인터페이스
│   │   │   └── PopupStoreRepository.java
│   │   └── port/                        # 포트 인터페이스
│   │       ├── PopupStoreRepositoryPort.java
│   │       └── PopupStoreServicePort.java
│   ├── application/                     # 애플리케이션 계층
│   │   └── service/                     # 유스케이스
│   │       └── PopupStoreApplicationService.java
│   └── infrastructure/                  # 인프라 계층
│       ├── persistence/                 # 영속성 어댑터
│       │   ├── PopupStorePersistenceAdapter.java
│       │   └── PopupStoreJpaRepository.java
│       └── web/                         # 웹 어댑터
│           └── PopupStoreWebAdapter.java
└── src/test/java/
    ├── domain/
    ├── application/
    └── infrastructure/
```

## 6. 의존성 규칙 검증

### ✅ 허용되는 의존성

- `popupmoah-api` → `popupmoah-{domain}` (application 계층)
- `popupmoah-{domain}` (application) → `popupmoah-{domain}` (domain)
- `popupmoah-{domain}` (infrastructure) → `popupmoah-{domain}` (application)
- 모든 모듈 → `popupmoah-shared`
- 모든 모듈 → `popupmoah-infrastructure-common`

### ❌ 금지되는 의존성

- `popupmoah-{domain}` (domain) → `popupmoah-{domain}` (application/infrastructure)
- `popupmoah-{domain}` (application) → `popupmoah-{domain}` (infrastructure)
- `popupmoah-shared` → 다른 모듈
- `popupmoah-infrastructure-common` → 도메인 모듈

이러한 의존성 규칙을 통해 Hexagonal Architecture의 원칙을 준수하고, MSA 전환을 위한 준비를 마칠 수 있습니다.
